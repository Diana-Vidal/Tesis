library(data.table)
library(tidyverse)
variables <- c("ENTIDAD_RES", "MUNICIPIO_RES", "FECHA_DEF", "CLASIFICACION_FINAL")
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99")
View(COVID2020)
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3))
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3))
View(COVID2021)
variables <- c("ID_REGISTRO", "ENTIDAD_RES", "MUNICIPIO_RES", "FECHA_DEF", "CLASIFICACION_FINAL")
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3))
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3))
View(COVID2020)
View(COVID2020)
COVIDmerge <- rbind(COVID2020, COVID2021)
View(COVIDmerge)
COVIDmerge <- rbind(COVID2020, COVID2021) %>%
filter(duplicated(.))
View(COVID2020)
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF)) %>%
filter(FECHA_DEF <= "2020-12-31")
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF)) %>%
filter(FECHA_DEF <= "2021-12-31")
View(COVID2021)
COVIDmerge <- rbind(COVID2020, COVID2021)
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF)) %>%
filter(FECHA_DEF <= "2021-12-31" & FECHA_DEF >= "2021-01-01")
View(COVID2021)
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3))
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
filter(FECHA_DEF !=  "9999-99-99",
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF)) %>%
filter(FECHA_DEF <= "2021-12-31")
COVIDmerge <- rbind(COVID2020, COVID2021)
View(COVIDmerge)
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF)) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3))
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF)) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
filter(FECHA_DEF <= "2020-12-31")
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF))
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
filter(FECHA_DEF <= "2020-12-31")
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
filter(FECHA_DEF <= "2021-12-31")
COVIDmerge <- rbind(COVID2020, COVID2021)
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3))
COVIDmerge <- rbind(COVID2020, COVID2021) %>%
filter(duplicated(ID_REGISTRO))
COVIDmerge <- rbind(COVID2020, COVID2021)
CONAPO1 <- read.csv("Bases/CONAPO/base_municipios_final_datos_01.csv")
CONAPO1 <- fread("Bases/CONAPO/base_municipios_final_datos_01.csv")
View(CONAPO1)
CONAPO2 <- fread("Bases/CONAPO/base_municipios_final_datos_02.csv")
CONAPO1 <- fread("Bases/CONAPO/base_municipios_final_datos_01.csv") %>%
rename("AÑO" = 7)
CONAPO1 <- fread("Bases/CONAPO/base_municipios_final_datos_01.csv") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021"))
CONAPO1 <- fread("Bases/CONAPO/base_municipios_final_datos_01.csv") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021")) %>%
group_by(CLAVE_ENT, NOM_ENT, MUN, AÑO) %>%
summarise(POB=sum(POB))
CONAPO2 <- fread("Bases/CONAPO/base_municipios_final_datos_02.csv") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021")) %>%
group_by(CLAVE_ENT, NOM_ENT, MUN, AÑO) %>%
summarise(POB=sum(POB))
View(CONAPO2)
CONAPO1 <- fread("Bases/CONAPO/base_municipios_final_datos_01.csv") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021")) %>%
group_by(CLAVE_ENT, NOM_ENT, AÑO) %>%
summarise(POB=sum(POB))
CONAPO2 <- fread("Bases/CONAPO/base_municipios_final_datos_02.csv") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021")) %>%
group_by(CLAVE_ENT, NOM_ENT, AÑO) %>%
summarise(POB=sum(POB))
CONAPO1 <- fread("Bases/CONAPO/base_municipios_final_datos_01.csv", encoding = "UTF-8") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021")) %>%
group_by(CLAVE_ENT, NOM_ENT, AÑO) %>%
summarise(POB=sum(POB))
CONAPO1 <- fread("Bases/CONAPO/base_municipios_final_datos_01.csv", encoding = "ISO-8859-1") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021")) %>%
group_by(CLAVE_ENT, NOM_ENT, AÑO) %>%
summarise(POB=sum(POB))
CONAPO1 <- fread("Bases/CONAPO/base_municipios_final_datos_01.csv", encoding = "Latin-1") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021")) %>%
group_by(CLAVE_ENT, NOM_ENT, AÑO) %>%
summarise(POB=sum(POB))
CONAPO2 <- fread("Bases/CONAPO/base_municipios_final_datos_02.csv", encoding = "Latin-1") %>%
rename("AÑO" = 7) %>%
filter(AÑO %in% c("2020","2021")) %>%
group_by(CLAVE_ENT, NOM_ENT, AÑO) %>%
summarise(POB=sum(POB))
write.csv(CONAPO2, "Bases/CONAPO/CONAPO2.csv", row.names = F)
write.csv(CONAPO2, "Bases/CONAPO/CONAPO2.csv", row.names = F, fileEncoding = "Latin-1")
write.csv(CONAPO2, "Bases/CONAPO/CONAPO2.csv", row.names = F, fileEncoding = "ISO-8859-1")
CONAPO2 <- read.csv("Bases/CONAPO/CONAPO2.csv")
CONAPO2 <- fread("Bases/CONAPO/CONAPO2.csv")
View(CONAPO2)
CONAPO2 <- fread("Bases/CONAPO/CONAPO2.csv", encoding = "Latin-1")
CONAPOS <- rbind(CONAPO1, CONAPO2)
View(CONAPOS)
CONAPO2020 <- rbind(CONAPO1, CONAPO2) %>%
filter(AÑO=="2020")
View(CONAPO2020)
CONAPO2021 <- rbind(CONAPO1, CONAPO2) %>%
filter(AÑO=="2021")
View(CONAPO2021)
mortalidad2020 <- left_join(COVID2020, CONAPO2020, by = c("ENTIDAD_RES" = "CLAVE_ENT"))
View(mortalidad2020)
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
group_by(FECHA_DEF, ENTIDAD_RES) %>%
summarise(NUM_DEF = n())
COVID2020 <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
group_by(ENTIDAD_RES) %>%
summarise(NUM_DEF = n())
COVID2020_ <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3))
View(COVID2020_)
variables <- c("ID_REGISTRO", "ENTIDAD_UM", "FECHA_DEF", "CLASIFICACION_FINAL")
COVID2020_ <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3))
View(COVID2020_)
COVID2020_ <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
group_by(ENTIDAD_RES) %>%
summarise(NUM_DEF = n())
COVID2020_ <- fread("Bases/Datos abiertos/COVID19MEXICO2020.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
group_by(ENTIDAD_UM) %>%
summarise(NUM_DEF = n())
sum(COVID2020_$NUM_DEF)
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
filter(FECHA_DEF <= "2021-12-31") %>%
group_by(ENTIDAD_UM) %>%
summarise(NUM_DEF = n())
sum(COVID2020_$NUM_DEF)+sum(COVID2021$NUM_DEF)
View(COVID2020)
COVID2021_ <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
filter(FECHA_DEF <= "2021-12-31") %>%
group_by(ENTIDAD_UM) %>%
summarise(NUM_DEF = n())
COVID2021 <- fread("Bases/Datos abiertos/COVID19MEXICO2021.csv", select = variables) %>%
mutate(FECHA_DEF = as.Date(FECHA_DEF,format = "%Y-%m-%d")) %>%
filter(!is.na(FECHA_DEF),
CLASIFICACION_FINAL %in% c(1,2,3)) %>%
filter(FECHA_DEF <= "2021-12-31")
mortalidad2020_ <- left_join(COVID2020_, CONAPO2020, by = c("ENTIDAD_UM" = "CLAVE_ENT"))
View(mortalidad2020_)
mortalidad2020_ <- left_join(COVID2020_, CONAPO2020, by = c("ENTIDAD_UM" = "CLAVE_ENT")) %>%
mutate(tasa_mortalidad = (NUM_DEF/POB)*10000)
mortalidad2021_ <- left_join(COVID2021_, CONAPO2021, by = c("ENTIDAD_UM" = "CLAVE_ENT")) %>%
mutate(tasa_mortalidad = (NUM_DEF/POB)*10000)
View(mortalidad2021_)
COVIDmerge <- rbind(COVID2020_, COVID2021_)
View(COVIDmerge)
COVIDmerge <- rbind(COVID2020_, COVID2021_) %>%
grupo by(ENTIDAD_UM) %>%
COVIDmerge <- rbind(COVID2020_, COVID2021_) %>%
group_by(ENTIDAD_UM) %>%
summarise(NUM_DEF = sum(NUM_DEF))
COVIDmerge_ <- rbind(COVID2020_, COVID2021_) %>%
group_by(ENTIDAD_UM) %>%
summarise(NUM_DEF = sum(NUM_DEF))
View(COVIDmerge_)
COVIDmerge_ <- rbind(COVID2020_, COVID2021_) %>%
group_by(ENTIDAD_UM) %>%
summarise(NUM_DEF = sum(NUM_DEF)) %>%
left_join(.,CONAPO2021, by = c("ENTIDAD_UM" = "CLAVE_ENT")) %>%
mutate(tasa_mortalidad = (NUM_DEF/POB)*10000)
install.packages("raster")
install.packages("leaflet")
library(raster)
library(stringi)
library(leaflet)
library(tidyverse)
library(data.table)
library(raster)
#Paso 3: Limpieza de la infomación de los mapas
MX <- getData("GADM", country = "MX", level = 1)
View(mortalidad2020_)
# MX@data$NAME_1 <- toupper(MX@data$NAME_1)
# MX@data$NAME_1 <- stri_trans_general(MX@data$NAME_1, "Latin-ASCII")
MX@data$NAME_1[which(MX@data$NAME_1%in% c("Distrito Federal"))]<- "Ciudad de México"
palnumeric <- colorQuantile(domain = mortalidad2020_$tasa_mortalidad,n = 7,
palette = c("#f7b267","#f79d65","#f4845f", "#f27059", "#f25c54","#f42b03","#e70e02"))
#Paso 5: Creando el mapa
leaflet() %>%
addProviderTiles(provider = "CartoDB.PositronNoLabels") %>%
addPolygons(data = MX , fillColor  = ~palnumeric(mortalidad2020_$tasa_mortalidad), color = "black", weight = 1,
label = MX$NAME_1,
smoothFactor = 0.5,
opacity = 1.0,
fillOpacity = 0.5) %>%
addLegend(data = MX, position = "topright", pal = palnumeric, values = ~mortalidad2020_$tasa_mortalidad,
title = "Mortalidad por COVID-19")
palnumeric <- colorQuantile(domain = mortalidad2020_$tasa_mortalidad,n = 5,
palette = c("#f7b267","#f79d65","#f4845f", "#f27059", "#f25c54","#f42b03","#e70e02"))
#Paso 5: Creando el mapa
leaflet() %>%
addProviderTiles(provider = "CartoDB.PositronNoLabels") %>%
addPolygons(data = MX , fillColor  = ~palnumeric(mortalidad2020_$tasa_mortalidad), color = "black", weight = 1,
label = MX$NAME_1,
smoothFactor = 0.5,
opacity = 1.0,
fillOpacity = 0.5) %>%
addLegend(data = MX, position = "topright", pal = palnumeric, values = ~mortalidad2020_$tasa_mortalidad,
title = "Mortalidad por COVID-19")
palnumeric <- colorQuantile(domain = mortalidad2021_$tasa_mortalidad,n = 5,
palette = c("#f7b267","#f79d65","#f4845f", "#f27059", "#f25c54","#f42b03","#e70e02"))
#Paso 5: Creando el mapa
leaflet() %>%
addProviderTiles(provider = "CartoDB.PositronNoLabels") %>%
addPolygons(data = MX , fillColor  = ~palnumeric(mortalidad2021_$tasa_mortalidad), color = "black", weight = 1,
label = MX$NAME_1,
smoothFactor = 0.5,
opacity = 1.0,
fillOpacity = 0.5) %>%
addLegend(data = MX, position = "topright", pal = palnumeric, values = ~mortalidad2021_$tasa_mortalidad,
title = "Mortalidad por COVID-19")
